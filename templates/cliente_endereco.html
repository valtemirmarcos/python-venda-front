{% extends 'layout/base.html' %}

{% block title %} Quitanda online :: Pedidos {% endblock %}
{% block content %}
<main class="flex-fill">
    <div class="container">
        <h1>Minha Conta</h1>
        <div class="row gx-3">
            <div class="col-4">
                {% include 'menu_cliente.html' %}
            </div>
            <div class="col-8">
                <form action="{{url_for('cliente.salvarEndereco')}}" method="post">
                    <div class="form-floating mb-3 col-md-6 col-lg-4">
                        <input class="form-control" type="text" id="txtCEP" name="txtCEP" placeholder=" " value="{{dados['cep']}}"  autofocus />
                        <label for="txtCEP">CEP</label>
                    </div>
                    <div class="mb-3 col-md-6 col-lg-8">
                        <textarea class="form-control text-muted bg-light text" id="txtLogradouro" name="txtLogradouro" style="height: 58px; font-size: 14px;">{{dados['logradouro']}}</textarea>
                    </div> 
                    <div class="form-floating mb-3 col-md-4">
                        <input class="form-control" type="text" id="txtNumero" name="txtNumero" placeholder=" " value="{{dados['numero']}}" autofocus />
                        <label for="txtNumero">Número</label>
                    </div>
                    <div class="form-floating mb-3 col-md-8">
                        <input class="form-control" type="text" id="txtComplemento" name="txtComplemento" placeholder=" " value="{{dados['complemento']}}" autofocus />
                        <label for="txtComplemento">Complemento</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input class="form-control" type="text" id="txtReferencia" name="txtReferencia" placeholder=" " value="{{dados['referencia']}}" autofocus />
                        <label for="txtReferencia">Ponto de Referência</label>
                    </div>     
                    <div class="form-floating mb-3">
                        <input class="form-control" type="text" id="txtCidade" name="txtCidade" placeholder=" " value="{{dados['cidade']}}" autofocus />
                        <label for="txtCidade">Cidade</label>
                    </div>   
                    <div class="form-floating mb-3">
                        <input class="form-control" type="text" id="txtUf" name="txtUf" placeholder=" " value="{{dados['uf']}}" autofocus />
                        <label for="txtUf">UF</label>
                    </div> 
                    <button type="submit" class="btn btn-lg btn-danger">Salvar</button>                      
                </form>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block js %}
    <script>
        var urlAPi = "{{session['urlApi']}}";
        console.log(urlAPi);
        $(function(){
            console.log("endereco");
        });
        $(document).on('blur',"#txtCEP",(evt)=>{
            evt.preventDefault();
            evt.stopPropagation();
            // console.log("ok");
            var cep = $("#txtCEP").val();
            executarApi(urlAPi, cep);

            console.log(urlAPi);
        });
        function executarApi(url, cep){
            console.log(url+"/usuarios/consultaCep?cep="+cep);
            $.ajax({
                url: url+"/usuarios/consultaCep?cep="+cep, 
                type: "GET",
                dataType: "json", 
                contentType: "application/json", 
                success: function(response) {
                    if (response.status != 'success'){
                        alert("cep nao encontrado");
                        return false;
                    }
                    var dados = response.data;
                    $("#txtLogradouro").val(dados.street);
                    $("#txtCidade").val(dados.city);
                    $("#txtUf").val(dados.uf);
                    console.log(response)

                },
                error: function(error) {
                    // Manipula erros na requisição (exibir mensagem de erro)
                    console.error("Erro ao enviar dados:", error);
                }
            });
        }
    </script>
{% endblock %}